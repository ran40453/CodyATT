<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>åŠ ç­è¡¨ç®¡ç†</title>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script>
    // ç‰ˆæœ¬æ¨™ç±¤ï¼ˆæ–¹ä¾¿åœ¨ console çœ‹åˆ°ç›®å‰ç‰ˆè™Ÿï¼‰
    window.__CW_DEPLOY_TAG = "<?= DEPLOY_TAG ?>";
    // å¾ Apps Script æ¨¡æ¿æ³¨å…¥çš„åˆå§‹åŠ ç­è³‡æ–™ï¼ˆgetOvertimeData çš„å›å‚³å€¼ï¼‰
    window.__OT_INIT_PAYLOAD__ = <?!= INIT_DATA_JSON ?>;
  </script>
  <?!= include('style'); ?>
</head>

<body>

  <!-- åˆ†é å°èˆªåˆ—ï¼ˆå›ºå®šé¡¯ç¤ºï¼‰ -->
  <nav class="tab-navigation">
    <button class="tab-btn active" data-tab="overview">
      <span class="material-symbols-outlined">dashboard</span>
      Overview
    </button>
    <button class="tab-btn" data-tab="analytics">
      <span class="material-symbols-outlined">analytics</span>
      Analytics
    </button>
  </nav>

  <!-- Overview Tab (åŸæœ‰å…§å®¹) -->
  <div class="tab-content active" id="overview-tab">
    <div class="container">

      <!-- å·¦å´å€åŸŸ -->
      <div class="left-panel">

        <!-- Logo å¡ç‰‡ -->
        <div class="card logo-card" onclick="showOtMonthlySummary()" style="cursor:pointer;">
          <img
            src="https://static.wixstatic.com/media/f31164_8fb3a217689346059f1c7a5e599fa050~mv2.png/v1/fill/w_282,h_50,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/logoFONT.png"
            alt="OT Logo" class="logo-image">
        </div>

        <!-- Dashboard ç¸½è¨ˆ -->
        <div class="card dashboard">
          <h3>ç¸½è¨ˆ</h3>
          <div class="capsule-column">
            <div class="capsule-row">
              <span class="label">å‡ºå·®å¤©æ•¸</span>
              <span class="capsule black dashboard-value" id="travelDays">0</span>
            </div>
            <div class="capsule-row">
              <span class="label">åŠ ç­ç¸½æ™‚æ•¸</span>
              <span class="capsule black" id="totalOT">0</span>
            </div>
            <div class="capsule-row">
              <span class="detail-label">Base</span>
              <span class="capsule dark-gray" id="totalBase">0</span>
            </div>
            <div class="capsule-row">
              <span class="label">Travel</span>
              <span class="capsule dark-gray" id="totalTravel">0</span>
            </div>
            <div class="capsule-row">
              <span class="label">OT</span>
              <span class="capsule dark-gray" id="totalOTSalary">0</span>
            </div>
            <div class="capsule-row">
              <span class="label">è²»ç”¨ Total</span>
              <span class="capsule black dashboard-value" id="totalCost">0</span>
            </div>
            <div class="capsule-row">
              <span class="label">ç¸½æ”¶å…¥</span>
              <span class="capsule yellow dashboard-value" id="totalSalary">0</span>
            </div>
          </div>
        </div>


        <!-- è¼¸å…¥è¨­å®šå¡ç‰‡ -->
        <div class="card settings-card">
          <h3>è¼¸å…¥è¨­å®š</h3>
          <label>æœˆè–ª</label>
          <input type="number" id="salary" value="68000"><br>
          <label>ç¾å…ƒåŒ¯ç‡</label>
          <div style="display: flex; gap: 8px; align-items: center;">
            <input type="number" id="usdRate" value="30.9" style="flex: 1;">
            <button id="refreshRateOverviewBtn" class="icon-button" style="width: 44px; height: 44px; margin: 0;"
              title="æ›´æ–°åŒ¯ç‡">
              <span class="material-symbols-outlined">refresh</span>
            </button>
          </div>
          <label>Travel åœ‹å®¶</label>
          <select id="travelCountry">
            <option value="China">China</option>
            <option value="Vietnam">Vietnam</option>
            <option value="India">India</option>
          </select>
          <div class="settings-actions">
            <button id="exportCSVCard" class="icon-button">
              <span class="material-symbols-outlined">save</span>
            </button>
            <label for="importCSVCard" class="icon-button file-label">
              <span class="material-symbols-outlined">upload</span>
            </label>
            <button id="saveToSheetBtn" class="icon-button" aria-label="Save to Google Sheet">
              <span class="material-symbols-outlined">cloud_upload</span>
            </button>
            <!-- ä¸€éµè£œæ»¿æ—¥æœŸæŒ‰éˆ•ï¼ˆJS/CSS ä¹‹å¾Œå†å¯¦ä½œï¼‰ -->
            <button id="fillMissingDatesBtn" class="icon-button" aria-label="Fill missing dates">
              <span class="material-symbols-outlined">calendar_month</span>
            </button>
            <input type="file" id="importCSVCard" accept=".csv">
          </div>
        </div>
        <a class="icon-button mobile-table-toggle" href="#tableSection">
          <span class="material-symbols-outlined">table_view</span>
          <span class="mobile-table-toggle-label">æŸ¥çœ‹åŠ ç­æ˜ç´°</span>
        </a>

      </div>

      <!-- å³å´å€åŸŸ -->
      <div class="right-panel">

        <!-- æ–°å¢è³‡æ–™å¡ç‰‡ -->
        <div class="add-card">
          <input type="date" id="newDate">
          <input type="number" id="new167" placeholder="1.67">
          <input type="number" id="new134" placeholder="1.34">
          <input type="number" id="new166" placeholder="1.66">
          <input type="number" id="new267" placeholder="2.67">
          <button id="travelToggle" class="icon-button">Travel</button>
          <input type="text" id="newRemark" placeholder="Remark">
          <button id="addRowCard" class="icon-button">
            <span class="material-symbols-outlined">add</span>
          </button>
        </div>

        <!-- è¡¨æ ¼å®¹å™¨ -->
        <div id="tableContainer">
          <!-- è¡¨æ ¼ç”± JS å‹•æ…‹ç”Ÿæˆ -->
        </div>

      </div>

    </div>
  </div>
  <!-- End of Overview Tab -->

  <!-- Analytics Tab (æ–°å¢çš„åˆ†æé é¢) -->
  <div class="tab-content" id="analytics-tab">
    <div class="analytics-grid">

      <!-- æœˆä»½é¸æ“‡å™¨ -->
      <div class="card month-selector-card">
        <h3>ğŸ“… æœˆä»½ç¯©é¸</h3>
        <div class="month-picker">
          <button class="month-nav prev" id="prevMonthBtn">
            <span class="material-symbols-outlined">chevron_left</span>
          </button>
          <select id="monthFilter">
            <option value="">å…¨éƒ¨æœˆä»½</option>
            <!-- å‹•æ…‹ç”Ÿæˆé¸é … -->
          </select>
          <button class="month-nav next" id="nextMonthBtn">
            <span class="material-symbols-outlined">chevron_right</span>
          </button>
        </div>
        <button id="refreshRateBtn" class="icon-button" style="margin-top: 12px;">
          <span class="material-symbols-outlined">refresh</span>
          æ›´æ–°åŒ¯ç‡
        </button>
      </div>

      <!-- çµ±è¨ˆæ‘˜è¦å¡ç‰‡çµ„ -->
      <div class="stats-cards-row">
        <div class="stat-card">
          <span class="material-symbols-outlined stat-icon">event</span>
          <div class="stat-value" id="statWorkDays">0</div>
          <div class="stat-label">å·¥ä½œå¤©æ•¸</div>
        </div>
        <div class="stat-card">
          <span class="material-symbols-outlined stat-icon">schedule</span>
          <div class="stat-value" id="statOTHours">0</div>
          <div class="stat-label">ç¸½åŠ ç­æ™‚æ•¸</div>
        </div>
        <div class="stat-card">
          <span class="material-symbols-outlined stat-icon">flight</span>
          <div class="stat-value" id="statTravelDays">0</div>
          <div class="stat-label">å‡ºå·®å¤©æ•¸</div>
        </div>
        <div class="stat-card">
          <span class="material-symbols-outlined stat-icon">payments</span>
          <div class="stat-value" id="statTotalIncome">0</div>
          <div class="stat-label">ç¸½æ”¶å…¥</div>
        </div>
        <div class="stat-card">
          <span class="material-symbols-outlined stat-icon">trending_up</span>
          <div class="stat-value" id="statAvgDaily">0</div>
          <div class="stat-label">å¹³å‡æ—¥è–ª</div>
        </div>
      </div>

      <!-- åœ–è¡¨å€ -->
      <div class="card chart-card">
        <h3>ğŸ“ˆ æœˆåº¦åŠ ç­è¶¨å‹¢</h3>
        <canvas id="overtimeChart"></canvas>
      </div>

      <div class="card chart-card">
        <h3>ğŸ¥§ æ”¶å…¥çµæ§‹åˆ†æ</h3>
        <canvas id="incomeChart"></canvas>
      </div>

    </div>
  </div>
  <!-- End of Analytics Tab -->

  <?!= include('main'); ?>
</body>

</html>