<style>
    /* =========================================
       Aero Glass Design System
       ========================================= */
    :root {
        /* Vibrant Color Palette */
        --color-primary-rgb: 0, 122, 255;
        --color-primary: #007AFF;
        --color-primary-dark: #0056b3;
        --color-accent-rgb: 139, 92, 246;
        --color-accent: #8b5cf6;
        --color-success: #34C759;
        --color-warning: #FF9500;
        --color-danger: #FF3B30;

        /* Glassmorphism Tokens */
        --glass-bg: rgba(255, 255, 255, 0.75);
        --glass-bg-accent: rgba(255, 255, 255, 0.4);
        --glass-border: rgba(255, 255, 255, 0.5);
        --glass-blur: 24px;
        --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.08);

        /* Surface Colors */
        --surface-bg: #f8fbff;
        --text-primary: #1d1d1f;
        --text-secondary: #6e6e73;
        --text-tertiary: #86868b;

        /* Elevations */
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
        --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
        --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.12);

        /* Typography */
        --font-main: 'Outfit', -apple-system, system-ui, sans-serif;

        /* Motion */
        --ease-swift: cubic-bezier(0.4, 0, 0.2, 1);
        --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
        --duration-fast: 0.2s;
        --duration-normal: 0.3s;
        --duration-slow: 0.5s;
    }

    body.privacy-mode .privacy-hidden {
        filter: blur(12px) !important;
        opacity: 0.5;
        pointer-events: none !important;
        user-select: none !important;
    }

    /* Dark Mode Tokens (Future Proofing) */
    @media (prefers-color-scheme: dark) {
        :root {
            --glass-bg: rgba(28, 28, 30, 0.8);
            --glass-bg-accent: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.1);
            --surface-bg: #000000;
            --text-primary: #f5f5f7;
            --text-secondary: #86868b;
            --text-tertiary: #48484a;
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
        }
    }

    /* Neumorphism (Kept for compatibility but prioritized Aero) */
    :root[data-theme="neumorphic"] {
        --neumo-bg: #E0E5EC;
        --neumo-light: #ffffff;
        --neumo-shadow: #b8bec7;
        --neumo-text: #202731;
        --neumo-brand: #6366F1;
        --neumo-raised: 8px 8px 16px var(--neumo-shadow), -8px -8px 16px var(--neumo-light);
        --neumo-pressed: inset 2px 2px 5px var(--neumo-shadow), inset -2px -2px 5px var(--neumo-light);

        background-color: var(--neumo-bg) !important;
    }

    * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        font-family: var(--font-main);
    }

    [data-theme="neumorphic"] body {
        background: var(--neumo-bg) !important;
        background-color: var(--neumo-bg) !important;
        color: var(--neumo-text) !important;
        font-family: 'Quicksand', -apple-system, sans-serif !important;
    }

    [data-theme="neumorphic"] button,
    [data-theme="neumorphic"] .icon-button,
    [data-theme="neumorphic"] .file-label,
    [data-theme="neumorphic"] .promo-action-btn,
    [data-theme="neumorphic"] .ot-btn,
    [data-theme="neumorphic"] .multiplier-badge.green,
    [data-theme="neumorphic"] .circular-toggle-btn,
    [data-theme="neumorphic"] .smart-stepper,
    [data-theme="neumorphic"] .smart-stepper-add,
    [data-theme="neumorphic"] .tab-btn {
        background: var(--neumo-bg) !important;
        border: none !important;
        box-shadow: var(--neumo-raised) !important;
        color: var(--neumo-text) !important;
        transition: all 0.2s ease !important;
        user-select: none !important;
        -webkit-user-select: none !important;
        -webkit-tap-highlight-color: transparent !important;
    }

    [data-theme="neumorphic"] .card,
    [data-theme="neumorphic"] .add-card,
    [data-theme="neumorphic"] .add-card-circular,
    [data-theme="neumorphic"] .data-card,
    [data-theme="neumorphic"] .rule-card,
    [data-theme="neumorphic"] .modal-content,
    [data-theme="neumorphic"] .history-promo-card,
    [data-theme="neumorphic"] .toolbox-card,
    [data-theme="neumorphic"] .stat-column-card,
    [data-theme="neumorphic"] .chart-card {
        background: var(--neumo-bg) !important;
        border: none !important;
        box-shadow: var(--neumo-raised) !important;
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
        border-radius: 24px !important;
    }

    [data-theme="neumorphic"] .expand-wrapper:not(.open) {
        overflow: hidden !important;
        grid-template-rows: 0fr !important;
        margin-bottom: 0 !important;
    }

    [data-theme="neumorphic"] .expand-wrapper {
        overflow: visible;
        /* Override to allow shadows when OPEN */
        transition: grid-template-rows 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    [data-theme="neumorphic"] .expand-wrapper.open {
        margin-bottom: 12px;
    }

    /* Fixed Neumorphic Inset Shadow */
    [data-theme="neumorphic"] .neumo-inset {
        box-shadow: var(--neumo-inset) !important;
    }

    /* Fix shadow clipping */
    [data-theme="neumorphic"] .expand-inner {
        padding: 16px 20px !important;
        overflow: visible !important;
    }

    [data-theme="neumorphic"] .calendar-weekday-label {
        background: var(--neumo-bg) !important;
        box-shadow: var(--neumo-inset) !important;
        border: none !important;
        color: var(--neumo-text) !important;
        opacity: 0.8;
        font-weight: 600;
        border-radius: 8px;
        margin: 2px;
    }

    [data-theme="neumorphic"] .scoreboard-badge {
        background: var(--neumo-bg) !important;
        box-shadow: var(--neumo-raised) !important;
        border: 2px solid rgba(255, 255, 255, 0.4) !important;
        color: var(--neumo-text) !important;
    }

    [data-theme="neumorphic"] button.active,
    [data-theme="neumorphic"] .icon-button.active,
    [data-theme="neumorphic"] .smart-stepper.active {
        box-shadow: var(--neumo-pressed) !important;
        color: var(--neumo-brand) !important;
    }

    [data-theme="neumorphic"] button:active,
    [data-theme="neumorphic"] .icon-button:active,
    [data-theme="neumorphic"] .promo-action-btn:active,
    [data-theme="neumorphic"] .ot-btn:active,
    [data-theme="neumorphic"] .multiplier-badge.green:active {
        box-shadow: var(--neumo-pressed) !important;
        transform: translateY(1px);
    }

    [data-theme="neumorphic"] .save-btn:hover,
    [data-theme="neumorphic"] #saveToSheetBtn:hover,
    [data-theme="neumorphic"] .file-label:hover {
        box-shadow: var(--neumo-inset) !important;
    }

    [data-theme="neumorphic"] input,
    [data-theme="neumorphic"] select,
    [data-theme="neumorphic"] textarea,
    [data-theme="neumorphic"] .smart-stepper.active,
    [data-theme="neumorphic"] .capsule-popup {
        background: var(--neumo-bg) !important;
        box-shadow: var(--neumo-inset) !important;
        border: none !important;
        color: var(--neumo-text) !important;
    }

    [data-theme="neumorphic"] .info-chip,
    [data-theme="neumorphic"] .capsule {
        background: var(--neumo-bg) !important;
        box-shadow: var(--neumo-raised) !important;
        border: none !important;
        color: var(--neumo-text) !important;
    }

    [data-theme="neumorphic"] .tab-btn.active {
        box-shadow: var(--neumo-pressed) !important;
        background: var(--neumo-bg) !important;
        color: var(--neumo-brand) !important;
    }

    [data-theme="neumorphic"] .month-header {
        background: var(--neumo-bg) !important;
        box-shadow: var(--neumo-raised) !important;
        margin-bottom: 12px;
        border-radius: 16px;
        color: var(--neumo-text) !important;
    }

    html,
    body {
        max-width: 100%;
        overflow-x: hidden;
        margin: 0;
        /* iOS Viewport Fix */
        height: 100%;
        height: -webkit-fill-available;
    }

    /* 防止 iOS 自動放大輸入框 */
    input,
    select,
    textarea {
        font-size: 16px !important;
    }

    /* iOS 捲動優化 */
    .modal-body,
    .data-list-container,
    .analytics-scroll-container {
        -webkit-overflow-scrolling: touch;
    }

    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .fade-in-up {
        animation: fadeInUp var(--duration-normal) var(--ease-swift) both;
    }

    /* Base Styles */
    body {
        font-family: var(--font-main);
        background: var(--surface-bg);
        background-attachment: fixed;
        padding: 0;
        margin: 0;
        max-width: 100%;
        overflow-x: hidden;
        color: var(--text-primary);
    }

    /* MD3 Tab Navigation */
    /* Aero Glass Navigation Bar */
    .tab-navigation {
        display: flex;
        justify-content: center;
        gap: 12px;
        padding: 12px 24px;
        height: 72px;
        align-items: center;
        backdrop-filter: blur(var(--glass-blur));
        -webkit-backdrop-filter: blur(var(--glass-blur));
        background: var(--glass-bg-accent);
        border-bottom: 1px solid var(--glass-border);
        position: sticky;
        top: 0;
        z-index: 1000;
        width: 100%;
        margin-bottom: 24px;
    }

    .tab-btn {
        position: relative;
        flex: 1;
        max-width: 140px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 0 16px;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        font-weight: 500;
        font-size: 0.9rem;
        cursor: pointer;
        border-radius: 14px;
        transition: all var(--duration-normal) var(--ease-swift);
    }

    .tab-btn .material-symbols-outlined {
        font-size: 20px;
        transition: transform 0.3s var(--ease-spring);
    }

    .tab-btn.active {
        background: var(--color-primary);
        color: white;
        box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    }

    .tab-btn:hover:not(.active) {
        background: var(--glass-bg-accent);
        color: var(--text-primary);
    }

    /* Tab 內容區塊 */
    .tab-content {
        display: none;
        padding-top: 0px;
    }

    .tab-content.active {
        display: block;
        animation: fadeInUp 0.5s var(--ease-swift);
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .container {
        display: flex;
        flex-direction: column;
        gap: 32px;
        width: 100%;
        max-width: 1440px;
        margin: 0 auto;
        padding: 0 24px 100px 24px;
    }

    @media (min-width: 1024px) {
        .container {
            flex-direction: row;
            align-items: flex-start;
        }
    }

    /* Layout Panels */
    .left-panel {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 100%;
    }

    @media (min-width: 1024px) {
        .left-panel {
            position: sticky;
            top: 100px;
            max-width: 320px;
            flex-shrink: 0;
        }
    }

    .right-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 24px;
        width: 100%;
        min-width: 0;
    }

    .expand-wrapper {
        display: grid;
        grid-template-rows: 0fr;
        transition: grid-template-rows 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        min-height: 0;
    }

    .expand-wrapper:not(.open) {
        grid-template-rows: 0fr !important;
        margin-bottom: 0 !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        visibility: hidden;
        pointer-events: none;
    }

    .expand-wrapper.open {
        grid-template-rows: 1fr;
        visibility: visible;
        pointer-events: auto;
    }

    .expand-inner {
        min-height: 0;
        overflow: hidden;
        color: #000;
        /* Fix: Ensure text is black for visibility */
    }

    @media (min-width: 1024px) {
        .month-group {
            grid-column: 1 / -1;
            /* Span all columns of parent grid */
            display: grid;
            grid-template-rows: 0fr;
            /* For animation container */
            margin: 0;
            padding: 0;
            width: 100%;
        }

        .month-group.open {
            grid-template-rows: 1fr;
        }

        .month-group .expand-inner {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
            width: 100%;
            padding: 4px 0;
        }
    }

    /* Month Header Styles consolidated at bottom of top-level styles */

    /* Month Group Styles */
    .month-group {
        /* Desktop Grid items container */
        /* Must act as grid or subgrid logic on desktop */
        width: 100%;
    }

    @media (min-width: 1024px) {
        .month-group {
            /* Wrapper acts as grid item in parent but creates context */
            /* Remove grid-template-columns here to avoid constraining the inner child to one column */
            display: grid;
            /* grid-template-columns: repeat(7, 1fr);  <-- REMOVED CAUSE OF BUG */
            grid-auto-flow: row;
            /* Default */
            width: 100%;
            grid-column: 1 / -1;
            gap: 0;
            /* Gap handled by inner */
        }

        /* The inner container holds the actual grid items */
        .month-group .expand-inner {
            display: grid !important;
            /* Force grid */
            grid-template-columns: repeat(7, 1fr) !important;
            /* Force 7 columns */
            grid-auto-flow: row !important;
            /* Fix for descending sort staircase */
            gap: 12px;
            padding: 4px;
            width: 100%;
        }
    }

    /* 卡片樣式 (Unified Fluid Glass) */
    /* Aero Glass Card System */
    .card {
        width: 100%;
        padding: 24px;
        border-radius: 28px;
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur));
        -webkit-backdrop-filter: blur(var(--glass-blur));
        box-shadow: var(--glass-shadow);
        border: 1px solid var(--glass-border);
        box-sizing: border-box;
        transition: transform var(--duration-normal) var(--ease-swift),
            box-shadow var(--duration-normal) var(--ease-swift);
    }

    .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 48px 0 rgba(0, 0, 0, 0.12);
    }

    .card h3 {
        margin-top: 0;
        margin-bottom: 20px;
        font-weight: 700;
        font-size: 1.25rem;
        color: var(--text-primary);
        text-align: left;
    }

    /* Aero Glass Widgets */
    .dashboard-widgets-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-top: 12px;
    }

    .stat-widget {
        padding: 16px;
        border-radius: 20px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        transition: transform var(--duration-normal) var(--ease-spring);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .stat-widget:hover {
        transform: scale(1.05);
    }

    .stat-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 10px;
        box-shadow: var(--shadow-sm);
    }

    .stat-icon .material-symbols-outlined {
        font-size: 20px;
    }

    .stat-info {
        display: flex;
        flex-direction: column;
    }

    .stat-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-secondary);
    }

    .stat-value {
        font-size: 1.15rem;
        font-weight: 800;
        color: var(--text-primary);
    }

    .total-income-highlight {
        grid-column: 1 / -1;
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
        padding: 20px;
        border-radius: 24px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        color: white;
        box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
        margin-top: 8px;
    }

    .highlight-label {
        font-size: 0.85rem;
        font-weight: 500;
        opacity: 0.9;
    }

    .highlight-value {
        font-size: 2rem;
        font-weight: 800;
        letter-spacing: -1px;
    }

    /* Floating Action Button */
    .fab {
        position: fixed;
        bottom: 32px;
        right: 32px;
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: var(--color-primary);
        color: white;
        border: none;
        box-shadow: 0 8px 32px rgba(0, 122, 255, 0.4);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        transition: all var(--duration-normal) var(--ease-spring);
    }

    .fab:hover {
        transform: scale(1.1) rotate(90deg);
        background: var(--color-primary-dark);
        box-shadow: 0 12px 48px rgba(0, 122, 255, 0.5);
    }

    .fab:active {
        transform: scale(0.9);
    }

    .fab .material-symbols-outlined {
        font-size: 32px;
    }

    /* 按鈕 */
    button,
    .icon-button {
        width: auto;
        min-width: 44px;
        height: 44px;
        margin: 4px;
        padding: 0 12px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.45);
        background: linear-gradient(135deg,
                rgba(0, 122, 255, 0.95),
                rgba(0, 122, 255, 0.75));
        color: #1d1d1f;
        /* Fix: Dark text for better readability on light glass */
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        box-sizing: border-box;
        flex-shrink: 0;
    }

    .icon-button {
        width: 44px;
        height: 44px;
        padding: 0;
    }

    .icon-button .material-symbols-outlined {
        font-size: 24px;
        display: flex;
        /* Use flex to center the character */
        align-items: center;
        justify-content: center;
        width: 1em;
        /* Standard sizing */
        height: 1em;
        line-height: normal;
        /* CRITICAL: Normalize character height */
        pointer-events: none;
        margin: 0;
        /* Reset margins */
        padding: 0;
    }

    /* Ensure all MD3 symbols in dashboard/chips are centered */
    .info-chip .material-symbols-outlined,
    .capsule-row .material-symbols-outlined {
        display: flex;
        align-items: center;
        justify-content: center;
        font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }

    .icon-button.privacy-btn.active {
        background: linear-gradient(135deg, #FF3B30, #FF2D55) !important;
        box-shadow: 0 4px 12px rgba(255, 59, 48, 0.3);
    }

    button:hover,
    .icon-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 30px rgba(0, 0, 0, 0.26);
    }

    button:active,
    .icon-button:active {
        transform: translateY(0);
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.2);
    }

    /* OT 上下箭頭：覆蓋一般按鈕樣式，縮小並貼在膠囊左右 */
    .ot-btns {
        display: flex;
        flex-direction: column;
        gap: 2px;
        margin-left: 6px;
    }

    .ot-btn {
        width: 20px;
        height: 20px;
        font-size: 14px;
        padding: 0;
        background: rgba(255, 255, 255, 0.3);
        color: #333;
        box-shadow: none;
        border: 1px solid rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .ot-btn:hover {
        background: rgba(255, 255, 255, 0.8);
        box-shadow: none;
        transform: translateY(-1px);
    }

    /* 隱藏原生數字增減按鈕 */
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* 輸入設定卡片內的數字輸入框 */
    .settings-card input[type="number"],
    .settings-card input[type="text"],
    .settings-card select {
        width: 100%;
        box-sizing: border-box;
        margin: 4px 0 8px;
        padding: 8px 12px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.45);
        background: rgba(255, 255, 255, 0.6);
        outline: none;
        color: #111;
        font-size: 0.9rem;
        transition: all 0.2s ease;
    }

    .settings-card input:focus,
    .settings-card select:focus {
        background: #fff;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15);
    }

    .settings-card label {
        font-size: 0.85rem;
        font-weight: 600;
        color: #555;
        margin-bottom: 4px;
        display: block;
    }

    /* 設定區按鈕排列 */
    .settings-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
        padding: 4px;
    }

    .actions-card {
        margin-top: 0;
        /* Align with standard gap */
        padding: 16px;
        display: flex;
        justify-content: center;
    }

    /* 設定卡片內的 icon 按鈕，縮成小圓形 */
    .settings-card .icon-button {
        width: 44px;
        height: 44px;
        padding: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .file-label {
        cursor: pointer;
    }

    input[type="file"] {
        display: none;
    }

    /* 右側區域 */
    .right-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 10px;
        overflow: visible;
        width: 100%;
    }


    /* 新增卡片 - Smart Stepper 統一設計 */
    .add-card-circular {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        /* Keep everything on one line for the slide-out effect */
        align-items: center !important;
        justify-content: flex-start !important;
        /* Align to start for natural sliding */
        gap: 12px !important;
        margin-bottom: 24px;
        position: relative;
        /* Remove sticky if it was causing issues, or keep it */
        background: rgba(255, 255, 255, 0.65);
        padding: 4px 16px;
        border-radius: 999px;
        z-index: 100;
        /* High enough to be over table but allow popups */
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        box-shadow: var(--glass-shadow);
        border: var(--glass-border);
        width: 100%;
        box-sizing: border-box;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        overflow: visible !important;
        /* Never clip popups */
    }

    /* Handle transition to rounded rectangle when expanded */
    .add-card-circular:has(.expandable-wrapper.expanded) {
        border-radius: 24px;
        padding: 12px 16px;
    }

    .add-card-item {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        min-width: 0;
    }

    .add-card-item label {
        font-size: 0.7rem;
        font-weight: 600;
        color: #8e8e93;
        text-align: center;
        white-space: nowrap;
    }

    /* Smart Stepper for Add Card (Override Global Button Styles) */
    .smart-stepper-add {
        width: 44px !important;
        height: 44px !important;
        border-radius: 50% !important;
        border: 2px solid rgba(0, 0, 0, 0.08) !important;
        background: rgba(255, 255, 255, 0.95) !important;
        color: #1d1d1f !important;

        /* Flex Alignment */
        display: flex !important;
        align-items: center;
        justify-content: center;

        font-size: 0.8rem;
        font-weight: 700;
        outline: none;
        cursor: ns-resize;
        transition: all 0.2s ease;
        padding: 0 !important;
        user-select: none;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        margin: 0 !important;
    }

    .circular-toggle-btn:hover {
        transform: scale(1.1);
        background: rgba(0, 0, 0, 0.08) !important;
    }

    .circular-toggle-btn:active {
        transform: scale(0.9);
    }

    .month-group {
        overflow: hidden;
    }

    .smart-stepper-add:hover {
        background: rgba(255, 255, 255, 1) !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
        transform: translateY(-1px);
    }

    .smart-stepper-add.active {
        background: var(--color-primary) !important;
        color: white !important;
        border-color: transparent !important;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3) !important;
        cursor: grabbing;
    }

    .smart-stepper-add.has-value {
        background: rgba(255, 255, 255, 1) !important;
        border-color: rgba(0, 122, 255, 0.3) !important;
    }

    .smart-stepper-add[data-type="date"] {
        border-color: rgba(0, 122, 255, 0.2) !important;
    }

    .smart-stepper-add[data-type="travel"] {
        border-color: rgba(255, 149, 0, 0.2) !important;
        color: var(--color-warning) !important;
    }

    /* 圓形新增按鈕（與其他按鈕同列） */
    .circular-add-btn-round {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        border: none;
        background: linear-gradient(135deg, var(--color-primary) 0%, #5AC8FA 100%);
        color: #ffffff !important;
        /* Force white for primary action button */
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        flex-shrink: 0;
        margin: 0;
    }

    .circular-add-btn-round:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 122, 255, 0.4);
    }

    .circular-add-btn-round:active {
        transform: scale(0.95);
    }


    .card-date {
        font: var(--md-sys-typescale-title-medium);
        font-size: 1.1rem;
        color: #1d1d1f !important;
        /* Force dark visibility */
        font-weight: 600;
    }

    /* Scoreboard Badge */
    /* Scoreboard Badge */
    .scoreboard-badge {
        background: #000000;
        color: #ffffff;
        padding: 2px 6px;
        /* Reduced padding */
        border-radius: 999px;
        font-family: 'Inter', monospace;
        font-weight: 700;
        font-size: 0.9rem;
        min-width: 24px;
        /* Reduced width */
        height: 24px;
        /* Fixed height for circle look */
        text-align: center;
        display: inline-flex;
        /* Use inline-flex */
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        line-height: 1;
    }

    /* Scoreboard Colors */
    .scoreboard-badge.green {
        color: #4ade80;
    }

    /* 2 */
    .scoreboard-badge.yellow {
        color: #facc15;
    }

    /* 3 */
    .scoreboard-badge.orange {
        color: #fb923c;
    }

    /* 4 */
    .scoreboard-badge.red {
        color: #f87171;
    }

    /* 5 */
    .scoreboard-badge.purple {
        color: #c084fc;
    }

    /* >6 */

    .card-secondary-info {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .info-chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--text-secondary);
        background: var(--glass-bg-accent);
        padding: 4px 12px;
        border-radius: 12px;
        border: 1px solid var(--glass-border);
        white-space: nowrap;
        transition: all var(--duration-fast) var(--ease-swift);
    }

    .info-chip:hover {
        background: var(--glass-bg);
        transform: translateY(-1px);
    }

    .info-chip.travel-chip.active {
        background: rgba(var(--color-primary-rgb), 0.1);
        color: var(--color-primary);
        border-color: rgba(var(--color-primary-rgb), 0.3);
    }

    .info-chip.yellow {
        background: rgba(255, 149, 0, 0.1);
        color: var(--color-warning);
        border-color: rgba(255, 149, 0, 0.3);
    }

    .info-chip .material-symbols-outlined {
        font-size: 16px;
    }

    .scoreboard-badge {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 10px;
        font-weight: 800;
        font-size: 1.1rem;
        background: var(--glass-bg-accent);
        border: 1px solid var(--glass-border);
        transition: transform var(--duration-normal) var(--ease-spring);
    }

    .scoreboard-badge:hover {
        transform: scale(1.1);
    }

    /* Scoreboard Coloring using primary/accent system */
    .scoreboard-badge.blue {
        color: var(--color-primary);
    }

    .scoreboard-badge.emerald {
        color: var(--color-success);
    }

    .scoreboard-badge.amber {
        color: var(--color-warning);
    }

    .scoreboard-badge.crimson {
        color: var(--color-danger);
    }

    .card-secondary-info {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .month-header {
        display: flex !important;
        justify-content: space-between;
        align-items: center;
        padding: 32px 16px 12px 16px;
        margin-top: 40px;
        margin-bottom: 20px;
        width: 100%;
        box-sizing: border-box;
        position: relative;
        z-index: 5;
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--text-primary);
        letter-spacing: -0.5px;
        grid-column: 1 / -1;
        border-bottom: 2px solid var(--color-primary);
    }

    .month-header>div {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    /* Universal UI Fixes (Moved to top-level) */
    #saveToSheetBtn {
        background: #FF9500 !important;
        /* Force solid orange over gradients */
        color: white !important;
        border: none !important;
        box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        position: relative;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    #saveToSheetBtn:hover {
        background: #FFA500 !important;
        transform: translateY(-2px);
    }

    #saveToSheetBtn.loading {
        background: #FF9500 !important;
        opacity: 0.9;
    }

    /* ... progress text and grid levels below ... */
    .progress-text {
        font-size: 14px;
        font-weight: 800;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        display: none;
        color: white;
    }

    #saveToSheetBtn.loading .material-symbols-outlined {
        display: none;
    }

    #saveToSheetBtn.loading .progress-text {
        display: block;
    }

    .contribution-grid {
        display: flex !important;
        flex-direction: row !important;
        gap: 2px;
        padding: 4px;
        background: rgba(255, 255, 255, 0.5) !important;
        border-radius: 6px;
        width: fit-content;
        max-width: 100%;
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch;
        z-index: 20 !important;
        display: flex !important;
        /* Force show on mobile */
    }

    .contribution-grid::-webkit-scrollbar {
        height: 2px;
    }

    .contribution-grid::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 2px;
    }

    .grid-cell {
        position: relative;
        width: 10px !important;
        height: 10px !important;
        min-width: 10px;
        min-height: 10px;
        border-radius: 2px;
        background: #e0e0e0;
        /* Default empty */
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        box-sizing: border-box;
    }

    /* Mobile: Shrink calendar to prevent overflow */
    .grid-cell {
        position: relative;
        width: 7px !important;
        height: 7px !important;
        min-width: 7px;
        min-height: 7px;
    }

    /* Ensure amount chips are fully visible on mobile */
    .card-secondary-info {
        flex-wrap: nowrap !important;
        justify-content: flex-end;
        gap: 4px;
    }

    .info-chip {
        flex-shrink: 0;
        white-space: nowrap;
    }

    .grid-cell:hover {
        transform: scale(1.4);
        z-index: 30;
    }

    /* Card Date Wrapper */
    .card-date-wrapper {
        display: flex;
        align-items: baseline;
        gap: 6px;
    }

    .date-day {
        font-weight: 700;
        font-size: 1.2rem;
        color: #1d1d1f !important;
    }

    .date-weekday {
        font-size: 0.9rem;
        color: #1d1d1f !important;
        /* Nuclear Fix: Forced dark color */
        font-weight: 600;
        text-transform: uppercase;
        opacity: 0.8;
    }

    /* Grid Layout for Hours */
    /* Container Reset */
    #tableContainer {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 0;
        width: 100%;
        max-width: 100%;
        /* Fill available space */
        margin: 0;
        /* Left align */
        box-sizing: border-box;
    }

    /* Weekday Header (Desktop Only) - Strict Alignment */
    .calendar-header {
        display: none;
        grid-template-columns: repeat(7, 1fr);
        gap: 12px;
        margin: 0 0 8px 0;
        /* Left align, no bottom margin */
        padding: 0;
        width: 100%;
        box-sizing: border-box;
    }

    .calendar-weekday-label {
        text-align: center;
        font: var(--md-sys-typescale-label-large);
        color: #1d1d1f !important;
        /* Force dark readability */
        text-transform: uppercase;
        font-weight: 700;
        opacity: 0.9;
    }

    /* =========================================
       Data Card Component (Aero Glass)
       ========================================= */
    .data-card {
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur)) saturate(180%);
        -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(180%);
        border-radius: 20px;
        box-shadow: var(--shadow-sm);
        padding: 0;
        overflow: hidden;
        transition: all var(--duration-normal) var(--ease-spring);
        position: relative;
        border: 1px solid var(--glass-border);
        display: flex;
        flex-direction: column;
    }

    .data-card:hover {
        transform: scale(1.02) translateY(-2px);
        box-shadow: var(--shadow-lg);
        z-index: 10;
        border-color: var(--color-primary);
    }

    .data-card:active {
        transform: scale(0.98);
        transition-duration: 0.1s;
    }

    /* Card Header (Always Visible) */
    .card-header {
        padding: 8px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        background: transparent;
        flex-wrap: wrap;
        gap: 8px;
        min-height: 56px;
    }

    .card-primary-info {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
    }

    /* Desktop Adaptation */
    @media (min-width: 1024px) {
        #tableContainer {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-auto-flow: row;
            gap: 12px;
            max-width: 100%;
            /* Full width */
            padding: 0;
            margin: 0;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
            max-width: 100%;
            padding: 0;
            margin: 0 0 12px 0;
        }

        .data-card {
            height: auto;
            min-height: 0;
        }
    }

    /* Toggle Buttons (Daily Cards) */
    .circular-toggle-btn.leave.active {
        background: rgba(186, 26, 26, 0.15) !important;
    }

    .circular-toggle-btn.leave.active span {
        color: #ba1a1a !important;
    }

    /* Grid Layout for Hours - Mobile Default: 4 columns (Single Row) */
    .hours-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        /* 4 columns on mobile */
        gap: 8px;
        margin-bottom: 12px;
        justify-items: center;
        width: 100%;
    }

    .hour-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        /* background: var(--md-sys-color-surface-container); Removed container bg for cleaner look with circles */
        padding: 4px;
        border-radius: 12px;
        width: 100%;
    }

    .hour-label {
        font: var(--md-sys-typescale-body-small);
        color: var(--md-sys-color-on-surface-variant);
        font-size: 0.7rem;
    }

    /* Circular Smart Stepper */
    .hour-item .smart-stepper {
        width: 44px;
        /* Fixed size */
        height: 44px;
        border-radius: 50%;
        /* Circle */
        font-size: 0.9rem;
        padding: 0;
        /* Reset padding */
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        background: #ffffff;
        /* Solid white for contrast */
    }

    /* Travel Toggle Row (Mobile) */
    .travel-toggle-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px dashed var(--md-sys-color-outline-variant);
    }

    /* Footer Actions */
    .card-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px dashed var(--md-sys-color-outline-variant);
    }

    .remark-text {
        font: var(--md-sys-typescale-body-medium);
        color: var(--md-sys-color-on-surface-variant);
        font-style: italic;
    }

    .card-actions {
        display: flex;
        gap: 8px;
    }

    .action-btn {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        color: var(--md-sys-color-on-surface-variant);
        cursor: pointer;
        transition: background 0.2s;
    }

    .action-btn:hover {
        background: var(--md-sys-color-surface-container);
        color: var(--md-sys-color-on-surface);
    }

    .action-btn.delete {
        color: #ba1a1a;
    }

    .action-btn.delete:hover {
        background: #ffdad6;
        color: #410002;
    }

    /* Desktop Adaptation (Calendar View) */
    @media (min-width: 1024px) {
        #tableContainer {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            /* Sun - Sat */
            grid-auto-flow: row;
            /* Fix staircase effect */
            gap: 12px;
            max-width: 1400px;
            /* Wider for calendar */
            padding: 0 16px;
            /* Ensure padding matches header */
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            /* Sun - Sat */
            gap: 12px;
            max-width: 1400px;
            margin: 0 auto 12px auto;
            padding: 0 16px;
            /* Match container padding */
        }

        /* Month Header Spanning */
        /* Removed redundant mobile-trapped header definition */

        .data-card {
            min-width: 0;
            /* Allow shrinking */
            display: flex;
            flex-direction: column;
            height: 100%;
            /* Uniform height */
        }

        /* Desktop Steppers: 2x2 */
        .hours-grid {
            grid-template-columns: repeat(2, 1fr);
            max-width: 120px;
            /* Constrain width */
            margin: 0 auto 12px auto;
        }

        /* Hide Weekday in Date on Desktop */
        .date-weekday {
            display: none;
        }

        /* Desktop Card Layout Override */
        .card-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }

        .card-primary-info {
            width: 100%;
            justify-content: space-between;
        }

        .card-secondary-info {
            width: 100%;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .card-expand-icon {
            display: none;
            /* Hide expand icon on desktop if we want cleaner look, or keep it */
        }

        /* Force Card Body to be Vertical Flex on Desktop (Override Grid Inheritance) */
        .card-body.expand-inner {
            display: flex !important;
            flex-direction: column !important;
            grid-template-columns: none !important;
            height: auto !important;
            padding: 4px 0 !important;
            /* Reduced padding */
            gap: 4px !important;
            /* Reduced gap */
        }

        /* Fix Layout for Content in Desktop Narrow Columns */
        .travel-toggle-row,
        .card-footer {
            display: flex;
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 4px !important;
            margin: 0 !important;
            width: 100%;
        }

        .remark-text {
            width: 100%;
            white-space: normal;
        }

        .card-actions {
            width: 100%;
            display: flex;
            justify-content: flex-end;
        }
    }

    /* 膠囊樣式 */
    .capsule {
        padding: 4px 10px;
        border-radius: 999px;
        margin: 2px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.85rem;
        border: 1px solid rgba(255, 255, 255, 0.35);
        backdrop-filter: blur(14px) saturate(140%);
        -webkit-backdrop-filter: blur(14px) saturate(140%);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
    }

    .capsule.green {
        background: linear-gradient(135deg,
                rgba(160, 231, 160, 0.9),
                rgba(160, 231, 160, 0.6));
        color: #0f2a0f;
        border-color: rgba(160, 231, 160, 0.9);
    }

    .capsule.orange {
        background: linear-gradient(135deg,
                rgba(255, 200, 124, 0.9),
                rgba(255, 200, 124, 0.6));
        color: #4a2c07;
        border-color: rgba(255, 200, 124, 0.9);
    }

    .capsule.gray {
        background: linear-gradient(135deg,
                rgba(224, 224, 224, 0.9),
                rgba(224, 224, 224, 0.5));
        color: #111;
        border-color: rgba(224, 224, 224, 0.9);
    }

    /* OT 與總計字體加粗 */
    .ot-value {
        font-weight: bold;
        font-size: 1rem;
    }

    .total-value {
        font-weight: bold;
        font-size: 1rem;
    }

    /* Dashboard 專用數值膠囊 */
    .dashboard-value {
        font-weight: 800;
        /* Bolder */
        font-size: 1.1rem;
        /* Slightly larger */
        display: inline-block;
        transform-origin: center bottom;
        color: #1d1d1f !important;
        /* Force dark visibility */
    }

    /* 子列（Base / Travel / OT Salary 細節區） */
    .detail-row {
        background: transparent;
    }

    .detail-row>td {
        padding: 0 !important;
        border-bottom: none;
        background: rgba(230, 230, 230, 0.95);
        width: 100%;
    }

    .detail-wrapper {
        display: none;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px 16px 12px;
        width: 100%;
        min-height: 50px;
        opacity: 0;
        transform: translateY(-4px);
        transition: opacity 0.3s ease, transform 0.3s ease;
        justify-content: flex-start;
    }

    /* 展開狀態 - 增加優先級 */
    .detail-row.open .detail-wrapper,
    tr.detail-row.open .detail-wrapper {
        display: flex !important;
        opacity: 1 !important;
        transform: translateY(0) !important;
    }

    /* 讓 label 與膠囊改成左右排列 */
    .detail-chip {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 6px;
        min-width: 80px;
        flex-shrink: 0;
    }

    /* 子清單內 Travel 左側小 toggle */
    .travel-toggle-inline {
        width: 22px;
        height: 22px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.45);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg,
                rgba(160, 160, 160, 0.95),
                rgba(120, 120, 120, 0.85));
        cursor: pointer;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.18);
        padding: 0;
    }

    .travel-toggle-inline.on {
        background: linear-gradient(135deg,
                rgba(0, 122, 255, 0.95),
                rgba(0, 122, 255, 0.75));
    }

    .detail-label {
        font-size: 0.8rem;
        opacity: 1;
        margin-left: 0;
        color: #1d1d1f !important;
        /* Force dark readability */
    }

    /* Removed redundant header definition */

    /* 每列右側刪除小圓點與確認氣泡 */
    .row-delete-wrapper {
        position: absolute;
        top: 50%;
        right: 2px;
        /* 保持貼齊儲存格右側，避免被瀏覽器裁切 */
        left: auto;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        /* 由內部按鈕接收事件 */
        z-index: 15;
        /* 確保浮在列背景之上 */
    }


    .row-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        padding: 0;
        border: none;
        background: #b4b4b4;
        box-shadow: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: transparent;
        /* 隱藏原文字，改用 ::before 顯示 */
        pointer-events: auto;
    }

    .row-dot::before {
        content: '';
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #6d6d6d;
        display: block;
    }

    .row-dot:hover {
        background: #e53935;
        transform: scale(3);
    }

    .row-dot:hover::before {
        content: '×';
        padding-left: 14px;
        width: auto;
        height: auto;
        background: transparent;
        color: #fff;
        font-size: 0.4rem;
        line-height: 1;
    }

    /* 刪除確認氣泡 */
    .delete-bubble {
        position: absolute;
        top: 50%;
        right: 26px;
        transform: translateY(-50%) translateX(8px);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.18s ease, transform 0.18s ease;
        z-index: 20;
    }

    .delete-bubble.open {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(-50%) translateX(0);
    }

    .delete-bubble-content {
        background: rgba(0, 0, 0, 0.82);
        color: #fff;
        padding: 8px 12px;
        border-radius: 12px;
        font-size: 0.78rem;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        white-space: nowrap;
    }

    .delete-bubble-content p {
        margin: 0 0 6px;
    }

    .delete-bubble-actions {
        display: flex;
        gap: 6px;
        justify-content: flex-end;
    }

    .delete-bubble-actions .delete-confirm,
    .delete-bubble-actions .delete-cancel {
        padding: 2px 8px;
        border-radius: 999px;
        border: none;
        box-shadow: none;
        font-size: 0.75rem;
        cursor: pointer;
    }

    .delete-bubble-actions .delete-confirm {
        background: #e53935;
        color: #fff;
    }

    .delete-bubble-actions .delete-cancel {
        background: rgba(255, 255, 255, 0.16);
        color: #fff;
    }

    .flip {
        animation: flip-card 0.4s ease;
    }

    @keyframes flip-card {
        0% {
            transform: rotateX(0deg);
            opacity: 1;
        }

        50% {
            transform: rotateX(90deg);
            opacity: 0.2;
        }

        100% {
            transform: rotateX(0deg);
            opacity: 1;
        }
    }

    /* 若 icon-button 被設定成正方形，統一視覺為圓形 */
    .icon-button[style*="width: 44px"],
    .icon-button[style*="height: 44px"] {
        border-radius: 999px;
    }

    /* 手機版響應式版面調整 */
    @media (max-width: 1024px) {
        body {
            padding: 8px 10px;
            /* 左右預留安全距離，且左右對稱 */
            font-size: 16px;
        }

        .container {
            flex-direction: column;
            gap: 16px;
            align-items: stretch;
        }

        .left-panel {
            position: static;
            width: 100%;
            gap: 10px;
        }

        .card,
        .logo-card {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            margin-bottom: 0;
        }

        /* Legacy Header Styles Removed */

        /* Privacy toggle in header */
        .toggle-btn-wrapper.privacy.active {
            color: #ba1a1a;
            background: rgba(186, 26, 26, 0.08);
        }

        .toggle-btn-wrapper:hover {
            transform: scale(1.02);
            background: rgba(255, 255, 255, 0.85);
        }

        .toggle-btn-wrapper:active {
            transform: scale(0.92);
            transition-duration: 0.1s;
        }

        .toggle-btn-wrapper .material-symbols-outlined {
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Styles promoted to top-level for universal visibility */

        /* Logo Card adjustments to fit in flex */
        .logo-card {
            flex: 1;
            margin-bottom: 0 !important;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .right-panel {
            width: 100%;
            flex: 1;
        }

        /* 手機版：避免內容超出螢幕寬度 */
        .container,
        .right-panel,
        table {
            max-width: 100%;
            box-sizing: border-box;
        }

        /* 新增卡片在手機版不固定在畫面頂部，跟著內容往下 */
        .add-card {
            position: static;
            top: auto;
            margin-top: 4px;
        }

        /* 手機版：新增列日期輸入欄縮短，避免擠壓其他欄位 */
        .add-card input[type="date"] {
            flex: 0 0 130px;
            max-width: 130px;
            width: 130px;
        }

        /* 手機版顯示「查看加班明細」按鈕 */
        /* Legacy .mobile-table-toggle width override removed */

        .mobile-table-toggle-label {
            font-size: 0.9rem;
        }

        /* 手機版表格更緊湊（僅套用在主 OT 表格） */
        #tableSection th,
        #tableSection td {
            padding: 6px 4px;
            font-size: 0.78rem;
        }

        .capsule {
            padding: 2px 6px;
            font-size: 0.78rem;
        }

        /* 手機版加班時數調整箭頭放大，點擊區域更友善 */
        .ot-arrow {
            font-size: 1.15rem;
            padding: 3px;
        }

        .ot-arrow .material-symbols-outlined {
            font-size: 1.6rem;
        }

        /* 手機版隱藏備註欄位（假設為最後一欄，限定主 OT 表格） */
        #tableSection thead th:last-child,
        #tableSection tbody td:last-child {
            display: none;
        }

        thead th {
            top: 0;
        }
    }

    /* 桌機版預設隱藏 mobile-table-toggle（上面 media query 會覆蓋） */
    /* 通知氣泡內文左右排版：標題靠左，數字靠右 */
    .ot-notify-bubble .notify-row {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 12px;
        margin: 2px 0;
    }

    .ot-notify-bubble .notify-label {
        flex: 1;
        text-align: left;
        white-space: nowrap;
        font-size: 0.9em;
        opacity: 0.9;
    }

    .ot-notify-bubble .notify-value {
        text-align: right;
        font-size: 1em;
        font-variant-numeric: tabular-nums;
        white-space: nowrap;
        margin-left: 12px;
    }

    /* .mobile-table-toggle display: none removed to allow desktop visibility */

    /* ========== Analytics 頁面樣式 ========== */
    .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        padding: 0 20px;
    }

    .month-selector-card {
        grid-column: 1 / -1;
    }

    .month-picker {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 12px;
    }

    .month-picker select {
        flex: 1;
        padding: 10px 16px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.45);
        background: rgba(207, 207, 207, 0.95);
        font-family: var(--font-system);
        font-size: 0.95rem;
        font-weight: 600;
        color: #111;
        outline: none;
        transition: all var(--duration-fast) var(--easing-standard);
    }

    .month-nav {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: none;
        background: var(--color-primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: var(--elevation-2);
    }

    .stats-cards-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
        grid-column: 1 / -1;
    }

    /* Analytics Adaptive Grid */
    .stats-columns {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 16px;
        width: 100%;
    }

    .stat-column-card,
    .chart-card {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        padding: 24px;
        box-shadow: var(--elevation-1);
        border: 1px solid rgba(255, 255, 255, 0.5);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .stat-column-card:hover,
    .chart-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--elevation-2);
        background: rgba(255, 255, 255, 0.85);
    }

    .chart-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 16px;
        width: 100%;
    }

    .column-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
    }

    .column-header h3 {
        margin: 0;
        font-size: 1.1rem;
        color: #333;
    }

    .icon-blue {
        color: #2196F3;
        background: #E3F2FD;
        padding: 8px;
        border-radius: 12px;
    }

    .icon-green {
        color: #4CAF50;
        background: #E8F5E9;
        padding: 8px;
        border-radius: 12px;
    }

    .icon-orange {
        color: #FF9800;
        background: #FFF3E0;
        padding: 8px;
        border-radius: 12px;
    }

    .stat-card {
        padding: 20px 16px;
        background: rgba(255, 255, 255, 0.16);
        backdrop-filter: blur(20px) saturate(160%);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: var(--elevation-2);
        text-align: center;
        transition: all var(--duration-normal) var(--easing-standard);
        cursor: pointer;
    }

    .stat-card:hover {
        transform: translateY(-6px) scale(1.02);
        box-shadow: var(--elevation-4);
    }

    .stat-icon {
        font-size: 2.8rem;
        display: block;
        margin-bottom: 10px;
    }

    .stat-value {
        font-size: 2.2rem;
        font-weight: 800;
        color: var(--color-primary);
    }

    .stat-label {
        font-size: 0.85rem;
        color: rgba(0, 0, 0, 0.65);
        font-weight: 600;
    }

    .chart-card {
        grid-column: span 2;
        min-height: 420px;
        padding: 24px;
    }

    .chart-card canvas {
        max-height: 360px;
        width: 100% !important;
    }

    /* Number Stepper */
    .number-stepper {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        background: rgba(255, 255, 255, 0.18);
        backdrop-filter: blur(12px);
        border-radius: 999px;
        box-shadow: var(--elevation-1);
    }

    .stepper-btn {
        width: 34px;
        height: 34px;
        border-radius: 50%;
        border: none;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        box-shadow: var(--elevation-1);
        padding: 0;
        margin: 0;
    }

    .stepper-btn:hover {
        transform: scale(1.15);
    }

    .stepper-btn.minus {
        background: linear-gradient(135deg, #FF6B6B, #EE5A6F);
    }

    .stepper-btn.plus {
        background: linear-gradient(135deg, var(--color-success), #2ecc71);
    }

    .stepper-value {
        min-width: 42px;
        text-align: center;
        font-weight: 700;
        font-size: 1.15rem;
    }

    /* Ripple */
    .ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.7);
        transform: scale(0);
        animation: ripple-animation 0.6s var(--easing-decelerate);
        pointer-events: none;
    }

    @keyframes ripple-animation {
        to {
            transform: scale(4);
            opacity: 0;
        }
    }

    /* Number Stepper 玻璃風格 */
    .number-stepper {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        background: rgba(255, 255, 255, 0.18);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.35);
        box-shadow: var(--elevation-1);
    }

    .stepper-btn {
        width: 34px;
        height: 34px;
        min-width: 34px;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.4);
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        color: rgba(0, 0, 0, 0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all var(--duration-fast) var(--easing-standard);
        position: relative;
        overflow: hidden;
        box-shadow: var(--elevation-1);
        padding: 0;
        margin: 0;
    }

    .stepper-btn:hover {
        transform: scale(1.15);
        box-shadow: var(--elevation-3);
        background: rgba(255, 255, 255, 0.35);
    }

    .stepper-btn:active {
        transform: scale(0.92);
        box-shadow: var(--elevation-1);
    }

    .stepper-btn.minus:hover {
        background: rgba(255, 107, 107, 0.25);
        border-color: rgba(255, 107, 107, 0.4);
    }

    .stepper-btn.plus:hover {
        background: rgba(52, 199, 89, 0.25);
        border-color: rgba(52, 199, 89, 0.4);
    }

    .stepper-btn .material-symbols-outlined {
        font-size: 20px;
        line-height: 1;
        font-weight: 600;
    }

    .stepper-value {
        min-width: 42px;
        text-align: center;
        font-weight: 700;
        font-size: 1.15rem;
        color: #111;
        font-family: var(--font-system);
        user-select: none;
    }

    /* Analytics 優化 - 減少空白 */
    .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 16px;
        padding: 0 16px;
    }

    .chart-card {
        grid-column: span 2;
        min-height: 380px;
        padding: 20px;
    }

    .stat-icon {
        font-size: 2.4rem !important;
        display: block;
        margin-bottom: 8px;
        color: var(--color-primary);
    }

    /* Spin 動畫 */
    @keyframes spin {
        from {
            transform: rotate(0deg);
        }

        to {
            transform: rotate(360deg);
        }
    }


    /* ========== UX 優化樣式 ========== */

    /* Stepper 按鈕：預設透明白色，hover 才顯示顏色 */
    .stepper-btn {
        width: 34px !important;
        height: 34px !important;
        border: 1px solid rgba(255, 255, 255, 0.4) !important;
        background: rgba(255, 255, 255, 0.2) !important;
        color: rgba(0, 0, 0, 0.5) !important;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12) !important;
    }

    .stepper-btn:hover {
        transform: scale(1.15) !important;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16) !important;
    }

    .stepper-btn.minus:hover {
        background: rgba(255, 107, 107, 0.3) !important;
        border-color: rgba(255, 107, 107, 0.6) !important;
        color: rgba(255, 59, 48, 0.9) !important;
    }

    .stepper-btn.plus:hover {
        background: rgba(52, 199, 89, 0.3) !important;
        border-color: rgba(52, 199, 89, 0.6) !important;
        color: rgba(52, 199, 89, 0.9) !important;
    }

    /* 數字：0時為灰色細字，>0才為黑色粗體 */
    .stepper-value {
        font-weight: 400 !important;
        color: rgba(0, 0, 0, 0.4) !important;
    }

    .stepper-value.has-value {
        font-weight: 700 !important;
        color: #111 !important;
    }

    /* 分頁導航固定頂部 */
    body>.tab-navigation {
        margin: 2px auto !important;
        max-width: 800px !important;
        position: sticky;
        top: 20px;
        z-index: 100;
    }

    /* Analytics 緊湊布局 */
    .analytics-grid {
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)) !important;
        gap: 14px !important;
        padding: 0 14px !important;
        max-width: 1400px;
        margin: 0 auto;
    }

    .month-selector-card {
        padding: 16px !important;
    }

    .stats-cards-row {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)) !important;
        gap: 10px !important;
    }

    .stat-card {
        padding: 16px 12px !important;
    }

    .chart-card {
        grid-column: span 1 !important;
        min-height: 320px !important;
        padding: 18px !important;
    }

    .chart-card canvas {
        max-height: 280px !important;
    }

    @media (min-width: 1024px) {
        .chart-card {
            grid-column: auto !important;
        }
    }

    /* 優化刪除按鈕 */
    .row-dot {
        width: 28px !important;
        height: 28px !important;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.35);
        backdrop-filter: blur(8px);
        transition: all 0.2s ease;
        font-size: 16px;
        color: rgba(0, 0, 0, 0.4);
    }

    .row-dot:hover {
        background: rgba(255, 59, 48, 0.15) !important;
        border-color: rgba(255, 59, 48, 0.4) !important;
        color: rgba(255, 59, 48, 0.9) !important;
        transform: scale(1.1);
    }

    .delete-confirm {
        background: rgba(255, 59, 48, 0.9) !important;
        color: white !important;
        border-color: rgba(255, 59, 48, 1) !important;
    }

    /* 手機版響應式優化 */
    @media (max-width: 768px) {
        /* 隱藏次要欄位 */
        th:nth-child(6),
        td:nth-child(6),
        /* 費用 Total */
        th:nth-child(7),
        td:nth-child(7),
        /* 月薪 */
        th:nth-child(8),
        td:nth-child(8)

        /* 備註 */
            {
            display: none;
        }

        /* 調整表格容器 */
        #tableContainer {
            overflow-x: hidden;
            /* 禁止橫向捲動 */
            width: 100%;
        }

        table {
            width: 100%;
            table-layout: fixed;
        }

        /* 調整欄寬分配 */
        th:nth-child(1) {
            width: 25%;
        }

        /* 日期 */
        th:nth-child(2),
        th:nth-child(3),
        th:nth-child(4),
        th:nth-child(5) {
            width: 15%;
        }

        /* OT */
        th:last-child {
            width: 15%;
        }

        /* 刪除 */

        /* 在子選單顯示隱藏的資訊 */
        .mobile-detail-item {
            display: flex !important;
        }
    }

    /* 桌面版隱藏手機專用資訊 */
    .mobile-detail-item {
        display: none;
    }

    /* Mobile Toggle Button for Table Rows */
    .mobile-toggle-btn {
        display: none;
        position: absolute;
        left: 4px;
        top: 50%;
        transform: translateY(-50%);
        width: 28px;
        height: 28px;
        padding: 0;
        border: none;
        background: rgba(0, 122, 255, 0.1);
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
        z-index: 10;
        align-items: center;
        justify-content: center;
    }

    .mobile-toggle-btn .material-symbols-outlined {
        font-size: 20px;
        color: var(--color-primary);
        transition: transform 0.2s ease;
    }

    .mobile-toggle-btn.open .material-symbols-outlined {
        transform: rotate(180deg);
    }

    .mobile-toggle-btn:active {
        background: rgba(0, 122, 255, 0.2);
        transform: translateY(-50%) scale(0.95);
    }

    @media (max-width: 768px) {
        .mobile-toggle-btn {
            display: flex;
        }

        /* 確保日期欄位有足夠空間容納按鈕 */
        table td:first-child {
            padding-left: 40px !important;
        }
    }

    /* ========== Tab Navigation (Like Mac Settings) ========== */
    .tab-navigation {
        display: flex;
        justify-content: center;
        background: transparent;
        /* No background */
        padding: 4px;
        margin: 0 auto 20px auto;
        border-radius: 999px;
        width: fit-content;
        /* box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); Remove shadow if transparent */
    }

    .tab-btn {
        padding: 8px 24px;
        border-radius: 999px;
        border: none;
        background: transparent;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 500;
        color: var(--md-sys-color-on-surface-variant);
        transition: all 0.2s ease;
        position: relative;
    }

    /* Smart Stepper (Drag-to-Adjust) */
    .smart-stepper {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 48px;
        height: 32px;
        background: rgba(255, 255, 255, 0.5);
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 16px;
        font-weight: 600;
        font-size: 14px;
        color: #333;
        cursor: ns-resize;
        /* 上下拖曳游標 */
        user-select: none;
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
    }

    .smart-stepper:hover {
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .smart-stepper.active {
        background: var(--color-primary);
        color: white;
        border-color: transparent;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        cursor: grabbing;
    }

    .smart-stepper.has-value {
        background: rgba(255, 255, 255, 0.9);
        color: #000;
        border-color: rgba(0, 0, 0, 0.2);
        font-weight: 700;
    }

    /* Analytics macOS Style Grid */
    .analytics-container {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 24px;
        padding: 0px 16px 24px 16px;
        max-width: 1400px;
        margin: 0 auto;
    }

    .analytics-header {
        grid-column: span 12;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }

    .analytics-header h2 {
        font-size: 2rem;
        font-weight: 700;
        color: #1d1d1f !important;
        margin: 0;
    }

    /* 篩選 Bar 優化 */
    .month-filter-wrapper {
        position: relative;
    }

    .month-select {
        appearance: none;
        -webkit-appearance: none;
        padding: 12px 40px 12px 20px;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(0, 0, 0, 0.08);
        border-radius: 12px;
        font-size: 0.95rem;
        font-weight: 600;
        color: #1d1d1f;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        min-width: 180px;
    }

    .month-select:hover {
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-color: rgba(0, 122, 255, 0.3);
    }

    .month-select:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 4px 16px rgba(0, 122, 255, 0.15);
    }

    .stats-columns {
        grid-column: span 12;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
    }

    .stat-column-card {
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur));
        -webkit-backdrop-filter: blur(var(--glass-blur));
        border-radius: 28px;
        padding: 32px;
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
        transition: all var(--duration-normal) var(--ease-swift);
        color: var(--text-primary);
    }

    .stat-column-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 16px 48px rgba(0, 0, 0, 0.1);
    }

    .column-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 24px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--glass-border);
    }

    .column-header h3 {
        margin: 0;
        font-size: 1.15rem;
        font-weight: 700;
        color: var(--text-primary);
    }

    .column-header .material-symbols-outlined {
        font-size: 32px;
    }

    .icon-blue {
        color: var(--color-primary);
    }

    .icon-green {
        color: var(--color-success);
    }

    .icon-orange {
        color: var(--color-warning);
    }

    .stat-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 18px;
        background: var(--glass-bg-accent);
        border-radius: 16px;
        transition: all var(--duration-fast) var(--ease-swift);
        border: 1px solid transparent;
    }

    .stat-item:hover {
        background: var(--glass-bg);
        border-color: var(--glass-border);
        transform: translateX(6px);
    }

    .stat-item .label {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-secondary);
    }

    .stat-item .value {
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--text-primary);
        font-variant-numeric: tabular-nums;
        letter-spacing: -0.5px;
    }

    .stat-item .value.highlight {
        color: var(--color-primary);
    }

    .chart-section {
        grid-column: span 12;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
    }

    .chart-card {
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur));
        -webkit-backdrop-filter: blur(var(--glass-blur));
        border-radius: 28px;
        padding: 32px;
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
        min-height: 400px;
        transition: all var(--duration-normal) var(--ease-swift);
    }

    .chart-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.1);
    }

    .chart-card h3 {
        margin: 0 0 24px 0;
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-primary);
    }

    @media (max-width: 1024px) {
        .stats-columns {
            grid-template-columns: 1fr;
        }

        .chart-section {
            grid-template-columns: 1fr;
        }
    }

    /* 配合左側導航調整主內容區域 */
    @media (min-width: 769px) {
        body {
            padding-left: 0;
            /* Removed legacy sidebar padding */
        }

        .container {
            padding: 16px 24px;
        }

        .tab-navigation {
            top: 0;
            left: 0;
            border-radius: 0;
        }

        .left-panel {
            padding-top: 0;
        }

        .analytics-container {
            padding-top: 32px;
        }
    }

    @media (max-width: 768px) {
        .container {
            padding: 16px;
        }

        .analytics-container {
            padding: 20px 16px;
        }
    }

    /* Modal Overlay */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .modal-overlay.active {
        display: flex;
        opacity: 1;
    }

    .modal-content {
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        transform: translateY(20px);
        transition: transform 0.3s ease;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        padding: 24px;
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .modal-overlay.active .modal-content {
        transform: translateY(0);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        position: sticky;
        top: 0;
        background: inherit;
        z-index: 10;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    /* Salary Record List */
    .salary-record-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 20px;
    }

    .salary-item {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 12px;
        align-items: center;
        background: rgba(255, 255, 255, 0.5);
        padding: 12px;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.8);
        transition: all 0.2s ease;
    }

    .salary-item:hover {
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .salary-item input {
        border: none;
        background: rgba(0, 0, 0, 0.05);
        padding: 8px 12px;
        border-radius: 10px;
        font-size: 0.95rem;
        font-weight: 600;
        width: 100%;
        text-align: center;
    }

    .salary-item .stepper-btn {
        border: none;
        padding: 8px 16px;
        border-radius: 10px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: ns-resize;
        text-align: center;
    }

    /* Modal Sections */
    .modal-body section h4 {
        margin: 0 0 12px 0;
        color: var(--primary);
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .modal-body hr {
        border: none;
        border-top: 1px solid rgba(0, 0, 0, 0.05);
        margin: 20px 0;
    }

    /* Fixed Travel Chip in Data Card (Compact) */
    .info-chip.travel-chip {
        padding: 2px 6px !important;
        min-width: 32px;
        justify-content: center;
        font-size: 0.75rem !important;
        font-weight: 700;
        gap: 0;
    }

    .info-chip.travel-chip span:not(.material-symbols-outlined) {
        margin: 0;
    }

    /* Hide flight icon in card chips as requested */
    .data-card .travel-chip .material-symbols-outlined {
        display: none;
    }

    .salary-item .stepper-btn {
        user-select: none;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .salary-item .stepper-btn.active {
        background: var(--color-primary);
        color: white;
    }

    .add-salary-btn {
        width: 100%;
        padding: 14px;
        border-radius: 16px;
        border: 2px dashed rgba(0, 0, 0, 0.1);
        background: transparent;
        color: var(--color-primary);
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .add-salary-btn:hover {
        background: rgba(0, 122, 255, 0.05);
        border-color: var(--color-primary);
    }

    .salary-actions {
        display: flex;
        gap: 8px;
    }

    /* Action Icons */
    .salary-actions .material-symbols-outlined {
        font-size: 22px;
    }

    .salary-actions .btn-v {
        color: #34c759;
        cursor: pointer;
    }

    .salary-actions .btn-x {
        color: #ff3b30;
        cursor: pointer;
    }

    /* Capsule Selector Styles */
    .capsule-container {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        overflow: visible;
        margin-top: 4px;
    }

    .capsule-toggle {
        height: 32px;
        padding: 0 12px;
        background: rgba(0, 122, 255, 0.1);
        color: var(--color-primary);
        border-radius: 16px;
        font-size: 13px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
        white-space: nowrap;
        z-index: 2;
    }

    .capsule-toggle:hover {
        background: rgba(0, 122, 255, 0.15);
    }

    .capsule-toggle.active {
        background: var(--color-primary);
        color: white;
    }

    .capsule-popup {
        display: flex;
        flex-direction: column;
        gap: 2px;
        background: white;
        padding: 6px;
        border-radius: 16px;
        position: absolute;
        left: 50%;
        top: calc(100% + 12px);
        /* Open DOWNWARD to avoid being clipped by top edge */
        width: 140px;
        /* Solid width for vertical list */
        max-height: 200px;
        opacity: 0;
        visibility: hidden;
        transform: translateX(-50%) translateY(-10px) scale(0.95);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 99999 !important;
        /* Maximum priority */
        overflow-y: auto;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        scrollbar-width: none;
    }

    .capsule-popup::-webkit-scrollbar {
        display: none;
        /* Hide scrollbar Chrome/Safari */
    }

    .capsule-popup.open {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(0) scale(1);
    }

    .capsule-option {
        padding: 8px 12px;
        width: 100%;
        border-radius: 10px;
        background: transparent;
        color: #444;
        font-size: 13px;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.2s ease;
    }

    .capsule-option:hover {
        background: rgba(0, 0, 0, 0.05);
    }

    /* Sub-capsule Unit for Leave Controls */
    .leave-capsule-unit {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 0;
        padding: 2px;
        border-radius: 999px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        background: transparent;
        height: 48px;
        width: auto;
        min-width: 44px;
        flex-shrink: 0 !important;
    }

    @media (max-width: 600px) {
        .add-card-item:has(#newLeaveToggle.on) {
            flex: 1 1 100% !important;
            order: 10;
        }
    }

    .leave-capsule-unit.expanded {
        background: rgba(0, 0, 0, 0.05);
        box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
        padding: 2px 12px 2px 2px;
        gap: 8px;
    }

    .expandable-wrapper {
        display: grid;
        grid-template-columns: 0fr;
        grid-template-rows: 1fr;
        transition: grid-template-columns 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275),
            grid-template-rows 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        overflow: hidden;
    }

    .expandable-wrapper.expanded {
        grid-template-columns: 1fr;
        overflow: visible;
    }

    .expandable-content {
        min-width: 0;
        min-height: 0;
        width: 100%;
    }

    #leaveInfoRow {
        margin-top: 0 !important;
        padding-top: 8px;
        display: flex;
    }

    .capsule-option.selected {
        background: rgba(0, 122, 255, 0.1) !important;
        color: var(--color-primary);
        font-weight: 700;
    }

    @keyframes spin {
        from {
            transform: rotate(0deg);
        }

        to {
            transform: rotate(360deg);
        }
    }

    body.is-dragging {
        user-select: none !important;
        -webkit-user-select: none !important;
    }

    /* 手機版新增列兩排顯示優化 */
    @media (max-width: 600px) {
        .add-card-circular {
            display: flex !important;
            flex-wrap: wrap !important;
            border-radius: 20px !important;
            padding: 12px 6px !important;
            gap: 4px !important;
            justify-content: center !important;
            height: auto !important;
        }

        .add-card-item {
            flex: 1 1 auto !important;
            /* Allow items to grow/shrink naturally */
            min-width: 60px;
        }

        .leave-capsule-unit {
            height: 40px !important;
            min-width: 44px !important;
            /* Fixed! No more overlap */
        }
    }

    /* =========================================
       Rules Modal & Cards
       ========================================= */
    .rules-modal-content {
        max-width: 600px !important;
    }

    .rules-sub-header {
        font-size: 0.75rem;
        font-weight: 700;
        color: #8e8e93;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        padding-left: 4px;
    }

    .rules-grid {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .rule-card {
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 16px;
        position: relative;
        overflow: hidden;
        transition: transform 0.2s ease;
    }

    .rule-card:hover {
        transform: translateY(-2px);
    }

    .rule-card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
    }

    .rule-icon-box {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .rule-icon-box.blue {
        background: rgba(0, 122, 255, 0.1);
        color: #007AFF;
    }

    .rule-icon-box.purple {
        background: rgba(142, 68, 173, 0.1);
        color: #8E44AD;
    }

    .rule-icon-box.amber {
        background: rgba(255, 149, 0, 0.1);
        color: #FF9500;
    }

    .rule-card-header h4 {
        margin: 0;
        font-size: 0.95rem;
        font-weight: 700;
        color: #1d1d1f;
    }

    .rule-card-header p {
        margin: 0;
        font-size: 0.75rem;
        color: #86868b;
    }

    .rule-items {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .rule-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 14px;
        background: rgba(255, 255, 255, 0.45);
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        font-size: 0.85rem;
        color: #48484a;
        font-weight: 500;
    }

    .rule-item.highlight-alt {
        background: rgba(52, 199, 89, 0.05);
        border-color: rgba(52, 199, 89, 0.2);
    }

    .multiplier-badge.green {
        font-size: 0.85rem;
        font-weight: 800;
        color: #1a7f37;
        /* GitHub Green */
        background: rgba(45, 164, 78, 0.1);
        padding: 6px 14px;
        border-radius: 8px;
        border: 1.5px solid rgba(45, 164, 78, 0.4);
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        min-width: 60px;
        text-align: center;
    }

    .multiplier-badge.green:hover {
        background: rgba(45, 164, 78, 0.2);
        border-color: rgba(45, 164, 78, 0.8);
        transform: scale(1.08);
        box-shadow: 0 4px 10px rgba(45, 164, 78, 0.2);
    }

    .multiplier-badge.green:active {
        transform: scale(0.95);
    }

    .rate-link {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        font-weight: 700;
        color: #8e8e93;
        background: rgba(0, 0, 0, 0.05);
        padding: 4px 10px;
        border-radius: 6px;
    }

    .history-promo-card {
        background: linear-gradient(135deg, rgba(94, 92, 230, 0.1), rgba(0, 122, 255, 0.1));
        border: 1px solid rgba(94, 92, 230, 0.2);
        border-radius: 20px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .promo-header {
        display: flex;
        gap: 12px;
    }

    .history-icon {
        color: #5E5CE6;
        background: rgba(94, 92, 230, 0.1);
        width: 36px;
        height: 36px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .promo-header h5 {
        margin: 0;
        font-size: 0.9rem;
        font-weight: 700;
        color: #1d1d1f;
    }

    .promo-header p {
        margin: 4px 0 0 0;
        font-size: 0.7rem;
        color: #48484a;
        line-height: 1.4;
    }

    .promo-action-btn {
        background: white;
        color: #5E5CE6;
        border: none;
        border-radius: 12px;
        padding: 12px;
        font-size: 0.85rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(94, 92, 230, 0.15);
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .promo-action-btn:hover {
        transform: scale(1.02);
        box-shadow: 0 6px 16px rgba(94, 92, 230, 0.2);
    }

    .promo-action-btn:active {
        transform: scale(0.98);
    }

    /* Analytics Neumorphic Fixes */
    [data-theme="neumorphic"] .analytics-container {
        background: var(--neumo-bg) !important;
    }

    [data-theme="neumorphic"] .stat-column-card,
    [data-theme="neumorphic"] .chart-card {
        background: var(--neumo-bg) !important;
        box-shadow: var(--neumo-raised) !important;
    }

    [data-theme="neumorphic"] .stat-item {
        background: var(--neumo-bg) !important;
        box-shadow: var(--neumo-inset) !important;
        border-radius: 12px;
        margin-bottom: 8px;
        border: none !important;
    }

    [data-theme="neumorphic"] .stat-item .value {
        color: var(--neumo-brand) !important;
        text-shadow: none !important;
    }
</style>```